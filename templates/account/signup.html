{% extends "base.html" %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load socialaccount %}
{% load static %}

{% block title %}{% trans "Sign Up" %} - AI Personal Journal{% endblock %}

{% block extra_css %}
<style>
/* Google Button Styling */
.btn-google {
    background: #ffffff;
    border: 2px solid #dadce0;
    color: #3c4043;
    font-weight: 500;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    padding: 0.625rem 1rem; /* ~10px 16px */
    font-size: 0.95rem;
    border-radius: 12px;
}

.btn-google:hover {
    background: #f8f9fa;
    border-color: #c6c8ca;
    color: #1a73e8;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.btn-google:focus {
    background: #f8f9fa;
    border-color: #1a73e8;
    color: #1a73e8;
    box-shadow: 0 0 0 0.2rem rgba(26, 115, 232, 0.25);
}

.btn-google i {
    font-size: 18px;
    background: linear-gradient(45deg, #ea4335, #fbbc05, #34a853, #1a73e8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Constrain button width on large screens */
.btn-google.w-100 { max-width: 420px; margin-left: auto; margin-right: auto; }

/* Divider Styling */
.divider-container {
    position: relative;
    text-align: center;
}

.divider-line {
    border: none;
    height: 1px;
    background: #e0e0e0;
    margin: 0;
}

.divider-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 14px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Card enhancements */
.card { border-radius: 20px; overflow: hidden; }

.card-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; border: none; }

/* Button animations */
.btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
.btn:hover { transform: translateY(-2px); }

/* Form styling */
.form-control:focus { border-color: #667eea; box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25); }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
    <div class="col-md-6">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white text-center py-4">
                    <i class="fas fa-rocket fa-3x mb-3"></i>
                    <h1 class="card-title mb-0">{% trans "Start Your AI Journal Journey" %}</h1>
                    <p class="mb-0 opacity-75">{% trans "Create your account and begin documenting your life with AI" %}</p>
                </div>
                
                <div class="card-body p-5">
                    <!-- Google OAuth Button (if available) -->
                    {% get_providers as socialaccount_providers %}
                    {% if socialaccount_providers %}
                        <div class="text-center mb-4">
                            {% for provider in socialaccount_providers %}
                                {% if provider.id == "google" %}
                                    <a href="{% provider_login_url 'google' %}" class="btn btn-google w-100 py-2 mb-3">
                                        <i class="fab fa-google me-3"></i>
                                        <strong>{% trans "Continue with Google" %}</strong>
                                    </a>
                                {% endif %}
                            {% endfor %}
                        </div>

                        <div class="divider-container mb-4">
                            <hr class="divider-line">
                            <span class="divider-text bg-white px-3 text-muted">{% trans "or" %}</span>
                        </div>
                    {% endif %}

                    <form class="signup" id="signup_form" method="POST" action="{% url 'account_signup' %}" novalidate>
                        {% csrf_token %}
                        {{ form|crispy }}

                        {% if redirect_field_value %}
                            <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
                        {% endif %}

                        <div class="d-grid gap-2 mt-4">
                            <button class="btn btn-primary py-2" type="submit">
                                <i class="fas fa-user-plus me-2"></i>
                                <strong>{% trans "Create Account" %}</strong>
                            </button>
                        </div>
                    </form>

                    <div class="mt-4 text-center">
                        <hr class="my-4">
                        <p class="mb-3">{% trans "Already have an account?" %}</p>
                        <a href="{% url 'account_login' %}" class="btn btn-outline-primary btn-lg">
                            <i class="fas fa-sign-in-alt me-2"></i>
                            {% trans "Sign In Instead" %}
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Features Preview -->
            <div class="card mt-4 border-0 bg-light">
                <div class="card-body p-4">
                    <h6 class="card-title text-center mb-3">
                        <i class="fas fa-magic text-primary me-2"></i>
                        {% trans "AI-Powered Journal Features" %}
                    </h6>
                    <div class="row g-2 text-center">
                        <div class="col-4">
                            <i class="fas fa-microphone text-success"></i>
                            <small class="d-block text-muted">{% trans "Voice Notes" %}</small>
                        </div>
                        <div class="col-4">
                            <i class="fas fa-camera text-info"></i>
                            <small class="d-block text-muted">{% trans "Photo AI" %}</small>
                        </div>
                        <div class="col-4">
                            <i class="fas fa-chart-line text-warning"></i>
                            <small class="d-block text-muted">{% trans "Insights" %}</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Security Notice -->
            <div class="card mt-4 border-0 bg-light">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-2 text-center">
                            <i class="fas fa-shield-alt fa-2x text-success"></i>
                        </div>
                        <div class="col-md-10">
                            <h6 class="card-title mb-1">{% trans "Your Privacy Matters" %}</h6>
                            <p class="card-text text-muted mb-0">
                                {% trans "Your journal entries are encrypted and private. We never share your personal data with third parties." %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('signup_form');
    
    // Ne PAS appliquer les styles immédiatement, seulement après soumission
    let formSubmitted = false;
    
    if (form) {
        form.addEventListener('submit', function(e) {
            formSubmitted = true;
            
            // Attendre que le serveur retourne les erreurs
            setTimeout(function() {
                applyErrorStyles();
            }, 300);
        });
        
        // Si des erreurs existent déjà au chargement (retour après soumission échouée)
        if (document.querySelectorAll('.text-danger, .invalid-feedback').length > 0) {
            applyErrorStyles();
        }
    }
    
    function applyErrorStyles() {
        // Appliquer la classe is-invalid aux champs avec erreurs
        const errorElements = document.querySelectorAll('.text-danger, .invalid-feedback, .alert-danger, .errorlist li');
        
        errorElements.forEach(function(errorElement) {
            // S'assurer que les erreurs sont visibles et en rouge
            errorElement.style.color = '#dc3545';
            errorElement.style.fontWeight = '500';
            errorElement.style.display = 'block';
            
            // Trouver le champ de formulaire associé
            const field = errorElement.closest('.form-group')?.querySelector('input, select, textarea') ||
                         errorElement.closest('.mb-3')?.querySelector('input, select, textarea');
            
            if (field && !field.classList.contains('is-invalid')) {
                field.classList.add('is-invalid');
                
                // Ajouter un écouteur pour enlever la classe quand l'utilisateur corrige
                field.addEventListener('input', function() {
                    if (this.value.trim() !== '') {
                        this.classList.remove('is-invalid');
                    }
                });
                
                field.addEventListener('change', function() {
                    if (this.value.trim() !== '') {
                        this.classList.remove('is-invalid');
                    }
                });
            }
        });
        
        // Spécialement pour les erreurs d'email
        const emailError = document.querySelector('#div_id_email .text-danger, #id_email + .text-danger');
        if (emailError) {
            emailError.style.color = '#dc3545';
            const emailField = document.getElementById('id_email');
            if (emailField) {
                emailField.classList.add('is-invalid');
            }
        }
    }
    
    // Pour les champs de date et autres champs spéciaux
    document.querySelectorAll('input[type="date"]').forEach(function(dateField) {
        dateField.addEventListener('change', function() {
            this.classList.remove('is-invalid');
        });
    });
});
</script>
{% endblock %}
